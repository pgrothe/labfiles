{"status":{},"contains_secrets":false,"product_version":"2.9.8.1","spec":{"description":"* sudo mysql -u root -p[PASSWORD]  \n* default password [ nutanix\/4u ]","resources":{"client_attrs":{"525dc891-e9d0-47f8-b4b8-3f1c25011486":{"y":400,"x":115},"a966ff8d-5588-46dd-a0a5-f27e1f840d8e":{"y":400,"x":115},"MySQL_Slave":{"y":400,"x":480},"9098b02b_deployment":{"y":400,"x":115},"2b6f81a8-73c0-4071-bc37-ea980eb29f64":{"y":400,"x":115},"8a9ab786-9be4-4c4f-9407-22e60cd7382e":{"y":400,"x":115},"79e30ecb-c041-400e-a269-0c278da56026":{"y":400,"x":480}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ConfigureMaster"},{"kind":"app_task","name":"GetDBState"}],"name":"a6df9f70_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ConfigureMaster"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"GetDBState"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureMaster","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\n# -*- Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\n\nserver_id=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep  \"server-id=\" | cut -d= -f2`\nis_master=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep -q -w \"#master=$server_id\"; echo $?`\n\n# -*- Run only on master\nif [ ${is_master} -eq 0 ]\nthen\nsudo sed -i \"\/\\[mysqld\\]\/a innodb_flush_log_at_trx_commit=1\" \/etc\/my.cnf.d\/nutanix.cnf\nsudo sed -i \"\/\\[mysqld\\]\/a sync_binlog=1\" \/etc\/my.cnf.d\/nutanix.cnf\n\nsudo mysql -u root -p${mysql_password}<<EOF\nCREATE USER 'replica'@'%' IDENTIFIED BY \"${mysql_password}\";\nGRANT REPLICATION SLAVE ON *.* to replica@'%';\nFLUSH PRIVILEGES;\nEOF\n\nfi\n\nsudo touch \/var\/run\/mysqld\/mysqld.sock\nsudo chown mysql:mysql \/var\/run\/mysqld\/mysqld.sock\nsudo systemctl restart mysqld\n\nsleep 5\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"GetDBState","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\nmaster_ip=\"@@{address}@@\"\n\nserver_id=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep  \"server-id=\" | cut -d= -f2`\nis_master=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep -q -w \"#master=$server_id\"; echo $?`\n\n\nif [ ${is_master} -eq 0 ]\nthen\n    while true\n    do\n      status=`sudo systemctl status mysqld | grep Active: | awk ' { print $3 }' | sed 's#[(|)]##g'`\n  \t  [ $status = \"running\" ] && break\n      echo $status\n  \t  sleep 2\n    done\n    \n    MYSQL_BIN=$(sudo mysql -u root -p${mysql_password} -e 'show master status;' | grep mysql-bin | awk '{print $1}')\n\tMYSQL_POSITION=$(sudo mysql -u root -p${mysql_password} -e 'show master status;' | grep mysql-bin | awk '{print $2}')\n    \n  echo \"MYSQL_BIN=$MYSQL_BIN\"\n  echo \"MYSQL_POSITION=$MYSQL_POSITION\"\nfi\n\n","eval_variables":["MYSQL_BIN","MYSQL_POSITION"],"eval_scope":"local","script_type":"sh","type":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]}],"description":"","name":"0a970522_runbook","main_task_local_reference":{"kind":"app_task","name":"a6df9f70_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3f9277cd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5fd47ec3_runbook","main_task_local_reference":{"kind":"app_task","name":"3f9277cd_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start"}],"name":"32e9c292_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Start","attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start mysqld\nsudo systemctl enable mysqld","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5ddb28d1_runbook","main_task_local_reference":{"kind":"app_task","name":"32e9c292_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ce63573f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0aefbca3_runbook","main_task_local_reference":{"kind":"app_task","name":"ce63573f_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c4afa1a6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7e709238_runbook","main_task_local_reference":{"kind":"app_task","name":"c4afa1a6_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MySQL_Master","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_BIN","value":"","label":"","attrs":{"type":""},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_POSITION","value":"","label":"","attrs":{"type":""},"is_hidden":false}],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ConfigureSlaves"}],"name":"93f99bda_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureSlaves","attrs":{"script":"#!\/bin\/bash\n\n# -*- Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\nmaster_ip=\"@@{MySQL_Master.address}@@\"\nmaster_bin=\"@@{MySQL_Master.MYSQL_BIN}@@\"\nmaster_position=\"@@{MySQL_Master.MYSQL_POSITION}@@\"\n\nserver_id=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep  \"server-id=\" | cut -d= -f2`\nis_master=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep -q -w \"#master=$server_id\"; echo $?`\n\n# -*- Runs on slaves\nif [ ${is_master} -ne 0 ]\nthen\n  sudo mysql -u root -p${mysql_password} -e \"change master to master_host='${master_ip}',master_user='replica',master_password='${mysql_password}',master_log_file='${master_bin}',master_log_pos=${master_position};\"\n  sudo mysql -u root -p${mysql_password} -e 'start slave;'\n  sudo mysql -u root -p${mysql_password} -e 'show slave status\\G' | grep -A11 Slave_IO_State\nfi\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"d54168c9_runbook","main_task_local_reference":{"kind":"app_task","name":"93f99bda_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"5066b603_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"92247e35_runbook","main_task_local_reference":{"kind":"app_task","name":"5066b603_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start"}],"name":"abefdcaf_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Start","attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start mysqld\nsudo systemctl enable mysqld","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a027cde0_runbook","main_task_local_reference":{"kind":"app_task","name":"abefdcaf_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"097fa65d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4a2ad0be_runbook","main_task_local_reference":{"kind":"app_task","name":"097fa65d_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e1f94389_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"f2b2a076_runbook","main_task_local_reference":{"kind":"app_task","name":"e1f94389_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MySQL_Master"}],"name":"MySQL_Slave","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"AHVMaster","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}},"categories":true}},"os_type":"Linux","create_spec":{"name":"mysql-master-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17f87d2a-7c76-4168-965a-32ecc96d7c8b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"7c1c691a-17b6-4983-9181-d2733ab15664","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS 7","uuid":"dbc00f43-42ef-487e-8984-1aa1cef2b022"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":7,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":8,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"AppFamily":"Databases"}},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"AHVSlave","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{},"serial_port_list":{},"boot_config":true,"disk_list":{"1":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true},"3":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"2":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"5":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"4":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"7":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"6":{"data_source_reference":true,"device_properties":{"disk_address":{}}},"8":{"data_source_reference":true,"device_properties":{"disk_address":{}}}}}}},"os_type":"Linux","create_spec":{"name":"mysql-slave-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17f87d2a-7c76-4168-965a-32ecc96d7c8b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"7c1c691a-17b6-4983-9181-d2733ab15664","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS 7","uuid":"dbc00f43-42ef-487e-8984-1aa1cef2b022"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":7,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":25600,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":8,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":{"AppFamily":"Databases"}},"variable_list":[]}],"credential_definition_list":[{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL_Master"}],"name":"AHVMasterPackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHVMasterPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install System Packages"},{"kind":"app_task","name":"Create Disk Setup"},{"kind":"app_task","name":"Install MySQL"},{"kind":"app_task","name":"Setup MySQL"}],"name":"9cbec184_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install System Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Disk Setup"}},{"from_task_reference":{"kind":"app_task","name":"Create Disk Setup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install MySQL"}},{"from_task_reference":{"kind":"app_task","name":"Install MySQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup MySQL"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install System Packages","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# -*- Install Mysql\nsudo yum update -y --quiet\nsudo yum install -y  wget xfs* bc unzip lvm2* lsscsi\n\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/sysconfig\/selinux\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/selinux\/config\nsudo setenforce 0\n\necho \"System packages are installed\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create Disk Setup","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n##############\n#\n# LVM setup script for MySQL . 4 disks for DATA and 4 for logs\n# Data disks are 50GB | Log disks are 25GB \n#\n#############\n\n\n#PGSQL data\nsudo pvcreate \/dev\/sdb \/dev\/sdc \/dev\/sdd \/dev\/sde\nsudo vgcreate mysqlDataVG \/dev\/sdb \/dev\/sdd \/dev\/sdc \/dev\/sde\nsudo lvcreate -l 100%FREE -i4 -I1M -n mysqlDataLV mysqlDataVG          ## Use 1MB to avoid IO amplification \n#lvcreate -l 100%FREE -i4 -I4M -n pgDataLV pgDataVG\n\n\n#PGSQL logs\nsudo pvcreate \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo vgcreate mysqlLogVG \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo lvcreate -l 100%FREE -i2 -I1M -n mysqlLogLV mysqlLogVG            ## Use 1MB to avoid IO amplification\n#lvcreate -l 100%FREE -i2 -I4M -n pgLogLV pgLogVG\n\n\n#Disable LVM read ahead\nsudo lvchange -r 0 \/dev\/mysqlDataVG\/mysqlDataLV\nsudo lvchange -r 0 \/dev\/mysqlLogVG\/mysqlLogLV\n\n\n#Format LVMs with ext4 and use nodiscard to make sure format time is fast on Nutanix due to SCSI unmap\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlDataVG\/mysqlDataLV\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlLogVG\/mysqlLogLV\n\nsleep 10\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install MySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo hostnamectl set-hostname \"@@{name}@@\"\n\n# -*- Mysql installation \nsudo yum install -y --quiet \"http:\/\/repo.mysql.com\/mysql80-community-release-el7.rpm\"\nsudo yum update -y --quiet\nsudo yum install -y --quiet sshpass mysql-community-server.x86_64\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Setup MySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n\necho \"!includedir \/etc\/my.cnf.d\" | sudo tee -a \/etc\/my.cnf\n\necho \"[mysqld]\nbinlog-format=mixed\nlog-bin=mysql-bin\ndatadir=\/mysql\/data\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\ninnodb_data_home_dir = \/mysql\/data\ninnodb_log_group_home_dir = \/mysql\/log\ninnodb_file_per_table\ntmpdir=\/mysql\/tmpdir\ninnodb_undo_directory = \/mysql\/undo\ndefault-storage-engine = innodb\ndefault_tmp_storage_engine = innodb\ninnodb_log_files_in_group = 4\ninnodb_log_file_size = 1G\ninnodb_log_buffer_size = 8M\ninnodb_buffer_pool_size = 6G\t\nlarge-pages\t\ninnodb_buffer_pool_instances = 64\t\ninnodb_flush_method=O_DIRECT\t\ninnodb_flush_neighbors=0\t \ninnodb_flush_log_at_trx_commit=1\ninnodb_buffer_pool_dump_at_shutdown=1\t\ninnodb_buffer_pool_load_at_startup=1\t\nbulk_insert_buffer_size = 256\t\ninnodb_thread_concurrency = 16\t\n \t \n# Undo tablespace\t \ninnodb_undo_tablespaces = 5\t\n \t \n# Networking\t \nwait_timeout=57600\t \nmax_allowed_packet=1G\t\nsocket=\/var\/lib\/mysql\/mysql.sock\t \nskip-name-resolve\nport=3306\t\nmax_connections=1000\t\n\n\n[mysqld_safe]\nlog-error=\/mysql\/log\/mysqld.log\npid-file=\/var\/run\/mysqld\/mysqld.pid\" | sudo tee \/etc\/my.cnf.d\/nutanix.cnf\n\nsudo sed -i \"\/\\[mysqld\\]\/a server-id=100\" \/etc\/my.cnf.d\/nutanix.cnf\necho \"#master=100\" | sudo tee -a  \/etc\/my.cnf.d\/nutanix.cnf\n\nserver_id=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep  \"server-id=\" | cut -d= -f2`\nis_master=`sudo cat \/etc\/my.cnf.d\/nutanix.cnf | grep -q -w \"#master=$server_id\"; echo $?`\n\nif [ ${is_master} -ne 0 ]\nthen\n   sudo sed -i '\/\\[mysqld\\]\/a read_only=1' \/etc\/my.cnf.d\/nutanix.cnf\nfi\n\n# -*- Sysctl configuration\nmysql_grp_id=`id -g mysql`\nsudo sysctl -w vm.swappiness=0\nsudo sysctl -w vm.nr_hugepages=1024\nsudo sysctl -w vm.overcommit_memory=1\nsudo sysctl -w vm.dirty_background_ratio=5 \nsudo sysctl -w vm.dirty_ratio=15\nsudo sysctl -w vm.dirty_expire_centisecs=500\nsudo sysctl -w vm.dirty_writeback_centisecs=100\nsudo sysctl -w vm.hugetlb_shm_group=$mysql_grp_id\n\necho \"vm.swappiness=0\nvm.nr_hugepages=1024\nvm.overcommit_memory=1\nvm.dirty_background_ratio=5 \nvm.dirty_ratio=15\nvm.dirty_expire_centisecs=500\nvm.dirty_writeback_centisecs=100\nvm.hugetlb_shm_group=$mysql_grp_id\" | sudo tee  -a \/etc\/sysctl.conf\n\necho \"ACTION=='add|change', SUBSYSTEM=='block', RUN+='\/bin\/sh -c \\\"\/bin\/echo 1024 > \/sys%p\/queue\/max_sectors_kb\\\"'\" | sudo tee \/etc\/udev\/rules.d\/71-block-max-sectors.rules\n\necho \"\/dev\/mysqlDataVG\/mysqlDataLV \/mysql\/data ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\necho \"\/dev\/mysqlLogVG\/mysqlLogLV \/mysql\/log ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\nsudo mkdir -p \/mysql\/log \/mysql\/data \/mysql\/tmpdir \/mysql\/undo\nsudo mount -a\nsudo chown -R mysql:mysql \/mysql\n\nsudo systemctl enable mysqld\n\nsudo rm -rf \/mysql\/data\/*\nsudo systemctl start mysqld\n\n#Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n\n#Mysql secure installation\nsudo mysql -u root<<-EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"ee9a3de0_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"9cbec184_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHVMasterPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageUninstallTask"}],"name":"7e474eb1_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"AHVMasterPackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageUninstallTask","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"4235ede6_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"7e474eb1_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL_Slave"}],"name":"AHVSlavePackage","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHVSlavePackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"Install System Packages"},{"kind":"app_task","name":"Create Disk Setup"},{"kind":"app_task","name":"Install MySQL"},{"kind":"app_task","name":"Setup MySQL"}],"name":"35a5e492_dag","state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Install System Packages"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Create Disk Setup"}},{"from_task_reference":{"kind":"app_task","name":"Create Disk Setup"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install MySQL"}},{"from_task_reference":{"kind":"app_task","name":"Install MySQL"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Setup MySQL"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install System Packages","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n# -*- Install Mysql\nsudo yum update -y --quiet\nsudo yum install -y  wget xfs* bc unzip lvm2* lsscsi\n\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/sysconfig\/selinux\nsudo sed -i 's\/^SELINUX=.*\/SELINUX=disabled\/' \/etc\/selinux\/config\nsudo setenforce 0\n\necho \"System packages are installed\"","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Create Disk Setup","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n##############\n#\n# LVM setup script for MySQL . 4 disks for DATA and 4 for logs\n# Data disks are 50GB | Log disks are 25GB \n#\n#############\n\n\n#PGSQL data\nsudo pvcreate \/dev\/sdb \/dev\/sdc \/dev\/sdd \/dev\/sde\nsudo vgcreate mysqlDataVG \/dev\/sdb \/dev\/sdd \/dev\/sdc \/dev\/sde\nsudo lvcreate -l 100%FREE -i4 -I1M -n mysqlDataLV mysqlDataVG          ## Use 1MB to avoid IO amplification \n#lvcreate -l 100%FREE -i4 -I4M -n pgDataLV pgDataVG\n\n\n#PGSQL logs\nsudo pvcreate \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo vgcreate mysqlLogVG \/dev\/sdf \/dev\/sdg \/dev\/sdh \/dev\/sdi\nsudo lvcreate -l 100%FREE -i2 -I1M -n mysqlLogLV mysqlLogVG            ## Use 1MB to avoid IO amplification\n#lvcreate -l 100%FREE -i2 -I4M -n pgLogLV pgLogVG\n\n\n#Disable LVM read ahead\nsudo lvchange -r 0 \/dev\/mysqlDataVG\/mysqlDataLV\nsudo lvchange -r 0 \/dev\/mysqlLogVG\/mysqlLogLV\n\n\n#Format LVMs with ext4 and use nodiscard to make sure format time is fast on Nutanix due to SCSI unmap\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlDataVG\/mysqlDataLV\nsudo mkfs.ext4 -E nodiscard \/dev\/mysqlLogVG\/mysqlLogLV\n\nsleep 10\n\n\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Install MySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo hostnamectl set-hostname \"@@{name}@@\"\n\n# -*- Mysql installation \nsudo yum install -y --quiet \"http:\/\/repo.mysql.com\/mysql80-community-release-el7.rpm\"\nsudo yum update -y --quiet\nsudo yum install -y --quiet sshpass mysql-community-server.x86_64\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Slave"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"Setup MySQL","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n\necho \"!includedir \/etc\/my.cnf.d\" | sudo tee -a \/etc\/my.cnf\n\necho \"[mysqld]\nbinlog-format=mixed\nlog-bin=mysql-bin\ndatadir=\/mysql\/data\nsql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\ninnodb_data_home_dir = \/mysql\/data\ninnodb_log_group_home_dir = \/mysql\/log\ninnodb_file_per_table\ntmpdir=\/mysql\/tmpdir\ninnodb_undo_directory = \/mysql\/undo\ndefault-storage-engine = innodb\ndefault_tmp_storage_engine = innodb\ninnodb_log_files_in_group = 4\ninnodb_log_file_size = 1G\ninnodb_log_buffer_size = 8M\ninnodb_buffer_pool_size = 6G\t\nlarge-pages\t\ninnodb_buffer_pool_instances = 64\t\ninnodb_flush_method=O_DIRECT\t\ninnodb_flush_neighbors=0\t \ninnodb_flush_log_at_trx_commit=1\ninnodb_buffer_pool_dump_at_shutdown=1\t\ninnodb_buffer_pool_load_at_startup=1\t\nbulk_insert_buffer_size = 256\t\ninnodb_thread_concurrency = 16\t\n \t \n# Undo tablespace\t \ninnodb_undo_tablespaces = 5\t\n \t \n# Networking\t \nwait_timeout=57600\t \nmax_allowed_packet=1G\t\nsocket=\/var\/lib\/mysql\/mysql.sock\t \nskip-name-resolve\nport=3306\t\nmax_connections=1000\t\n\n\n[mysqld_safe]\nlog-error=\/mysql\/log\/mysqld.log\npid-file=\/var\/run\/mysqld\/mysqld.pid\" | sudo tee \/etc\/my.cnf.d\/nutanix.cnf\n\necho \"#master=100\" | sudo tee -a  \/etc\/my.cnf.d\/nutanix.cnf\n\nserver_id=`sudo cat \/etc\/my.cnf | grep  \"server-id=\" | cut -d= -f2`\nis_master=`sudo cat \/etc\/my.cnf | grep -q -w \"#master=$server_id\"; echo $?`\n\nif [ ${is_master} -ne 0 ]\nthen\n   sudo sed -i '\/\\[mysqld\\]\/a read_only=1' \/etc\/my.cnf.d\/nutanix.cnf\nfi\n\n# -*- Sysctl configuration\nmysql_grp_id=`id -g mysql`\nsudo sysctl -w vm.swappiness=0\nsudo sysctl -w vm.nr_hugepages=1024\nsudo sysctl -w vm.overcommit_memory=1\nsudo sysctl -w vm.dirty_background_ratio=5 \nsudo sysctl -w vm.dirty_ratio=15\nsudo sysctl -w vm.dirty_expire_centisecs=500\nsudo sysctl -w vm.dirty_writeback_centisecs=100\nsudo sysctl -w vm.hugetlb_shm_group=$mysql_grp_id\n\necho \"vm.swappiness=0\nvm.nr_hugepages=1024\nvm.overcommit_memory=1\nvm.dirty_background_ratio=5 \nvm.dirty_ratio=15\nvm.dirty_expire_centisecs=500\nvm.dirty_writeback_centisecs=100\nvm.hugetlb_shm_group=$mysql_grp_id\" | sudo tee  -a \/etc\/sysctl.conf\n\necho \"ACTION=='add|change', SUBSYSTEM=='block', RUN+='\/bin\/sh -c \\\"\/bin\/echo 1024 > \/sys%p\/queue\/max_sectors_kb\\\"'\" | sudo tee \/etc\/udev\/rules.d\/71-block-max-sectors.rules\n\n\necho \"\/dev\/mysqlDataVG\/mysqlDataLV \/mysql\/data ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\necho \"\/dev\/mysqlLogVG\/mysqlLogLV \/mysql\/log ext4 rw,seclabel,noatime,nobarrier,stripe=4096,data=ordered 0 0\" | sudo tee -a \/etc\/fstab\nsudo mkdir -p \/mysql\/log \/mysql\/data \/mysql\/tmpdir \/mysql\/undo\nsudo mount -a\nsudo chown -R mysql:mysql \/mysql\n\nsudo systemctl enable mysqld\n\nsudo rm -rf \/mysql\/data\/*\nsudo systemctl start mysqld\n\n#Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n\n#Mysql secure installation\nsudo mysql -u root<<-EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"db3247c6_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"35a5e492_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHVSlavePackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageUninstallTask"}],"name":"53d74d7d_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"AHVSlavePackage"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageUninstallTask","state":"ACTIVE","attrs":{"exit_status":[],"script":"#!\/bin\/bash","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a4fbe7d2_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"53d74d7d_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","options":{"type":"","name":"AHV_CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ESX_CENTOS_76","version":"","options":{"type":"","name":"ESX_CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"9098b02b_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"AHVMasterPackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHVMaster"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"de329770_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"2","package_local_reference_list":[{"kind":"app_package","name":"AHVSlavePackage"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHVSlave"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"Take DB Backup. Specify absolute directory path for BACKUP_FILE_PATH","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"DB Backup"}],"name":"3e7d744d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DB Backup","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndate_part=`date +%F`\nmkdir -p @@{BACKUP_FILE_PATH}@@\nsudo mysqldump -u root -p${mysql_password} --all-databases | sudo gzip -9 > @@{BACKUP_FILE_PATH}@@\/db_dump.sql.gz","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"c6cd4595_runbook","main_task_local_reference":{"kind":"app_task","name":"3e7d744d_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BACKUP_FILE_PATH","value":"~\/db_backup","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"Backup"},{"description":"To restore DB from dump file. Specify absolute directory path for RESTORE_FILE_PATH","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"DB Restore"}],"name":"458965d2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL_Master"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DB Restore","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndb_file=@@{RESTORE_FILE_PATH}@@\n\nsudo gunzip < $db_file | sudo mysql -u root -p${mysql_password} ","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"412d41ad_runbook","main_task_local_reference":{"kind":"app_task","name":"458965d2_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"RESTORE_FILE_PATH","value":"~\/db_backup\/db_dump.sql.gz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"Restore"},{"description":"This action will scale out db slaves by given scale out count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out"}],"name":"0d5ad4a7_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"de329770_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Out","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"45be859a_runbook","main_task_local_reference":{"kind":"app_task","name":"0d5ad4a7_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleOut"},{"description":"This action will scale in db slaves by given scale out count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In"}],"name":"6baa6164_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"de329770_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale In","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"16496c32_runbook","main_task_local_reference":{"kind":"app_task","name":"6baa6164_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleIn"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"is_hidden":false}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"Demo MySQL Master Slave"},"api_version":"3.0","metadata":{"last_update_time":"1586671818867732","kind":"blueprint","spec_version":1,"creation_time":"1586670632873271","categories":{"AppFamily":"Databases"},"name":"Demo MySQL Master Slave"}}