{"status":{},"contains_secrets":false,"product_version":"2.9.8.1","spec":{"description":"* [Lamp](http:\/\/@@{HAPROXY.address}@@)","resources":{"client_attrs":{"7b153367-313c-44d9-8748-d1b9e05d61bf":{"y":22,"x":-92},"b26b05f4-94d3-4cdd-bd92-f8b43f036af2":{"y":279,"x":316},"56242f2e-6184-45ab-bd68-b061a059f12d":{"y":138.3673932788,"x":102.9405086285},"27ad5cad-2364-45d7-bbdb-12e646687eb4":{"y":22,"x":-92},"3cbbcddd-a6e5-4b47-9567-cdb824fc06c6":{"y":279,"x":316},"055671bd-c11f-47fe-bbed-227dd8577299":{"y":138.3673932788,"x":102.9405086285},"a9bcedad-b547-4f1a-a4af-e7c3e924fa38":{"y":279,"x":316},"2bc4e801-5328-42e4-964d-524d720c30d6":{"y":279,"x":316},"c4130c6a-c789-4a43-8c19-afc80bbb52ea":{"y":138.3673932788,"x":102.9405086285},"a8d82486-864b-4300-8bb3-650fe40e4e44":{"y":22,"x":-92},"7df0cc1c_deployment":{"y":138.3673932788,"x":102.9405086285},"d10bcd6d-3be2-47bd-953e-fb6162ba05be":{"y":138.3673932788,"x":102.9405086285},"4d96f2c3_deployment":{"y":22,"x":-92},"cbc66a9b_deployment":{"y":279,"x":316},"b3c2153d-dd8a-4b38-bf82-cf1e55578c1e":{"y":22,"x":-92}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"614e22c6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"55798d8c_runbook","main_task_local_reference":{"kind":"app_task","name":"614e22c6_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7d839765_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"631cf0ea_runbook","main_task_local_reference":{"kind":"app_task","name":"7d839765_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"075e4b33_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"68b3c509_runbook","main_task_local_reference":{"kind":"app_task","name":"075e4b33_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c857778e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"94704c3b_runbook","main_task_local_reference":{"kind":"app_task","name":"c857778e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e9e7d2d3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"65ac9163_runbook","main_task_local_reference":{"kind":"app_task","name":"e9e7d2d3_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MYSQL","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9807fe1b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a992bd98_runbook","main_task_local_reference":{"kind":"app_task","name":"9807fe1b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d3ab8fc3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4fd20db5_runbook","main_task_local_reference":{"kind":"app_task","name":"d3ab8fc3_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bfc74f9b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e4dbbc0a_runbook","main_task_local_reference":{"kind":"app_task","name":"bfc74f9b_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a5bfd22c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0ecebc2f_runbook","main_task_local_reference":{"kind":"app_task","name":"a5bfd22c_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"208adab8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4e962233_runbook","main_task_local_reference":{"kind":"app_task","name":"208adab8_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MYSQL"}],"name":"APACHE_PHP","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0ffc772f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0b37647d_runbook","main_task_local_reference":{"kind":"app_task","name":"0ffc772f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"345bfe30_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"42c025e9_runbook","main_task_local_reference":{"kind":"app_task","name":"345bfe30_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"8d2423f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4f6625e7_runbook","main_task_local_reference":{"kind":"app_task","name":"8d2423f8_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a483ed49_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ac17cd03_runbook","main_task_local_reference":{"kind":"app_task","name":"a483ed49_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9f7ae67d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5bb47e63_runbook","main_task_local_reference":{"kind":"app_task","name":"9f7ae67d_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"APACHE_PHP"}],"name":"HAPROXY","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"MYSQLAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}},"categories":true}},"os_type":"Linux","create_spec":{"name":"MYSQL-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17f87d2a-7c76-4168-965a-32ecc96d7c8b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"7c1c691a-17b6-4983-9181-d2733ab15664","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS 7","uuid":"dbc00f43-42ef-487e-8984-1aa1cef2b022"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"APACHE_PHP_AHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}},"categories":true}},"os_type":"Linux","create_spec":{"name":"APACHE_PHP@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17f87d2a-7c76-4168-965a-32ecc96d7c8b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"7c1c691a-17b6-4983-9181-d2733ab15664","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS 7","uuid":"dbc00f43-42ef-487e-8984-1aa1cef2b022"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAPROXYAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"timeout_secs":true},"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}},"categories":true}},"os_type":"Linux","create_spec":{"name":"HAPROXY-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"17f87d2a-7c76-4168-965a-32ecc96d7c8b"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":null,"power_state":"ON","type":"","account_uuid":"7c1c691a-17b6-4983-9181-d2733ab15664","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"CentOS 7","uuid":"dbc00f43-42ef-487e-8984-1aa1cef2b022"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"root","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS","editables":{"username":true,"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MYSQL"}],"name":"MYSQL_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"696811b8_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y --quiet \"http:\/\/repo.mysql.com\/mysql80-community-release-el7.rpm\"\nsudo yum update -y --quiet\nsudo yum install -y --quiet sshpass mysql-community-server\n\n\nsudo systemctl enable mysqld\nsudo systemctl start mysqld\n\n#Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n# -*- Mysql secure installation\nmysql -u root<<-EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fa139f70_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"696811b8_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"9f5b6937_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"add53bd1_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"9f5b6937_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"APACHE_PHP"}],"name":"APACHE_PHP_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"27550204_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n# -*- Install httpd and php\nsudo yum update -y\nsudo yum -y install epel-release\nsudo rpm -Uvh https:\/\/mirror.webtatic.com\/yum\/el7\/webtatic-release.rpm\nsudo yum install -y httpd php56w php56w-mysql\n\necho \"<IfModule mod_dir.c>\n        DirectoryIndex index.php index.html index.cgi index.pl index.php index.xhtml index.htm\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\n\necho \"<?php\nphpinfo();\n?>\" | sudo tee \/var\/www\/html\/info.php \nsudo systemctl restart httpd\nsudo systemctl enable httpd","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"124852e5_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"27550204_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"11c3b039_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"afe7faff_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"11c3b039_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAPROXY"}],"name":"HAPROXY_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"feefd61c_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\nsudo yum update -y\nsudo yum install -y haproxy\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0f3b1d56_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"feefd61c_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"b0165015_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"77f817b9_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"b0165015_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","options":{"type":"","name":"AHV_CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ESX_CENTOS_76","version":"","options":{"type":"","name":"ESX_CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"cbc66a9b_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MYSQL_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"7df0cc1c_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"2","package_local_reference_list":[{"kind":"app_package","name":"APACHE_PHP_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"APACHE_PHP_AHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"4d96f2c3_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAPROXY_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAPROXYAHV"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"This action will scale out App Server slaves by given scale out count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out App"},{"kind":"app_task","name":"Configure haproxy"}],"name":"788fce62_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out App"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure haproxy"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Out App","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure haproxy","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8a03e7aa_runbook","main_task_local_reference":{"kind":"app_task","name":"788fce62_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleOut"},{"description":"This action will scale in App Server slaves by given scale in count.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In App"},{"kind":"app_task","name":"Configure haproxy"}],"name":"51ca4a45_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale In App"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure haproxy"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale In App","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure haproxy","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5f546660_runbook","main_task_local_reference":{"kind":"app_task","name":"51ca4a45_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleIn"},{"description":"This action will take mysql backup.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Do DB Backup"}],"name":"723a972d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Do DB Backup","attrs":{"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndate_part=`date +%F`\nmkdir -p @@{BACKUP_FILE_PATH}@@\nsudo mysqldump -u root -p${mysql_password} --all-databases | sudo gzip -9 > @@{BACKUP_FILE_PATH}@@\/db_dump.sql.gz","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"98629b01_runbook","main_task_local_reference":{"kind":"app_task","name":"723a972d_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"BACKUP_FILE_PATH","value":"~\/db_backup","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"DBBackup"},{"description":"This action will restore mysql db from specified file.","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Do DB Restore"}],"name":"b4930fc2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Do DB Restore","attrs":{"script":"#!\/bin\/bash\n\n### Setup variables\nmysql_password=\"@@{MYSQL_PASSWORD}@@\"\ndb_file=@@{RESTORE_FILE_PATH}@@\n\nsudo gunzip < $db_file | sudo mysql -u root -p${mysql_password} ","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8a9b85d9_runbook","main_task_local_reference":{"kind":"app_task","name":"b4930fc2_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"RESTORE_FILE_PATH","value":"~\/db_backup\/db_dump.sql.gz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"DBRestore"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"is_hidden":false}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"Demo LAMP"},"api_version":"3.0","metadata":{"last_update_time":"1586671260503807","kind":"blueprint","spec_version":3,"creation_time":"1586670372802510","categories":{"AppFamily":"DevOps"},"name":"Demo LAMP"}}